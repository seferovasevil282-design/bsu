generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id              String   @id @default(uuid())
  fullName        String
  phone           String   @unique
  email           String   @unique
  password        String
  faculty         String
  degree          String
  course          Int
  profilePicture  String?
  isActive        Boolean  @default(true)
  reportCount     Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  sentMessages     Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
  blockedUsers     Block[]   @relation("BlockedBy")
  blockedBy        Block[]   @relation("Blocked")
  reports          Report[]  @relation("ReportedUser")
  reportsMade      Report[]  @relation("Reporter")

  @@map("users")
}

model Message {
  id         String   @id @default(uuid())
  content    String
  roomId     String?
  isPrivate  Boolean  @default(false)
  senderId   String
  receiverId String?
  timestamp  DateTime @default(now())
  createdAt  DateTime @default(now())

  sender   User  @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User? @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)

  @@map("messages")
  @@index([roomId])
  @@index([senderId])
  @@index([receiverId])
}

model Block {
  id        String   @id @default(uuid())
  blockerId String
  blockedId String
  createdAt DateTime @default(now())

  blocker User @relation("BlockedBy", fields: [blockerId], references: [id], onDelete: Cascade)
  blocked User @relation("Blocked", fields: [blockedId], references: [id], onDelete: Cascade)

  @@unique([blockerId, blockedId])
  @@map("blocks")
}

model Report {
  id         String   @id @default(uuid())
  reporterId String
  reportedId String
  createdAt  DateTime @default(now())

  reporter User @relation("Reporter", fields: [reporterId], references: [id], onDelete: Cascade)
  reported User @relation("ReportedUser", fields: [reportedId], references: [id], onDelete: Cascade)

  @@map("reports")
}

model Admin {
  id        String   @id @default(uuid())
  username  String   @unique
  password  String
  isSuper   Boolean  @default(false)
  createdAt DateTime @default(now())

  @@map("admins")
}

model Settings {
  id                      String   @id @default(uuid())
  rules                   String   @default("")
  dailyTopic              String   @default("")
  groupChatDeletionHours  Int      @default(24)
  privateChatDeletionHours Int     @default(48)
  filteredWords           String   @default("")
  updatedAt               DateTime @updatedAt

  @@map("settings")
}
